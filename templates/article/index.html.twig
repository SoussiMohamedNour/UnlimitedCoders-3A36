{% extends 'basebackarticle.html.twig' %}
{% block articlebutton %}
    <li class="menu-item ">
        <a class="menu-link" href="{{ path('app_article_stats') }}"> <i class="icon material-icons md-home"></i>
            <span class="text">Acceuil</span>
        </a>
    </li>
<li class="menu-item active">
    <a class="menu-link" href="{{ path('app_article_index') }}"> <i class="icon material-icons md-article"></i>
        <span class="text">Article</span>
    </a>
</li>
{% endblock %}
{% block stats %}
    <div class="row">
        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                    <div class="text">
                        <h6 class="mb-1">Total Articles</h6>  <span>   {{ articles|length }}</span>
                    </div>
                </article>

            </div> <!-- card  end// -->
        </div> <!-- col end// -->
        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                    <div class="text">
                        <h6 class="mb-1">Total commandes</h6> <span>100</span>
                    </div>
                </article>
            </div> <!-- card end// -->
        </div> <!-- col end// -->
        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-shopping_basket"></i></span>
                    <div class="text">
                        <h6 class="mb-1">Total Produits</h6>  <span>1000</span>
                    </div>
                </article>
            </div> <!--  end// -->
        </div> <!-- col end// -->
    </div> <!-- row end// -->

{% endblock %}
{% block table %}
    {% block titreArticle %} <h5>Liste des Articles </h5>{% endblock %}
 {% block articles %}

<table class="table table-hover" id="t">
        <thead>
            <tr>
                <th>Id</th>
                <th>Titre</th>
                <th>Description</th>
                <th>Date</th>
                <th>Article</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody id="all">
        {% for article in articles %}
            <tr>
                <td>{{ article.id }}</td>
                <td>{{ article.titre }}</td>
                <td>{{ article.articleDesc }}</td>
                <td>{{ article.articleDate ? article.articleDate|date('Y-m-d') : '' }}</td>
                <td>
                    {% if article.file|lower matches '/(pdf)$/' %}
                        <object data="{{ vich_uploader_asset(article, 'fileFile') }}" type="application/pdf" width="80" height="80    ">
                            <p>Your web browser doesn't have a PDF plugin. Instead you can <a href="{{ vich_uploader_asset(article, 'fileFile') }}">click here to download the PDF file.</a></p>
                        </object>
                    {% elseif article.file|lower matches '/(mp4|webm|ogv)$/' %}
                        <video controls width="80" height="80">
                            <source src="{{ vich_uploader_asset(article, 'fileFile') }}" type="video/{{ article.file|lower|split('.')|last }}">
                            Your browser does not support the video tag.
                        </video>
                   {% else %}
                    <img src="{{vich_uploader_asset(article,'fileFile') }}" width="80" height="80">
                    {% endif %}
                        </td>{# file display #}
                <td>
                    <a href="{{ path('app_article_show', {'id': article.id}) }}"><img src="{{ asset('images/detail.png') }}" height="30" width="30"></a>
                    <a href="{{ path('app_article_edit', {'id': article.id}) }}"><img src="{{ asset('images/refresh.png') }}" height="30" width="30"></a>
                    {{ include('article/_delete_form.html.twig') }}
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">Aucun Article</td>
            </tr>
        {% endfor %}
        </tbody>
<tbody id="search">
</tbody>
</table>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
     </script>
     <script>
         $( document ).ready(function() {
             $("#search").keyup(function(e){
                 /* La variable value va prendre la valeur insérer dans le champ de texte afin d’effectuer la recherche */
                 var value = $(this).val();
                 /* Ajax est lancé lors du remplissage du champ texte dont l’id est « search » pour faire la recherche */

                 $.ajax({
                     /* l’url est une chaine de caractères contenant l’adresse où la requête est envoyée */
                     url : "{{ path('app_article_search') }}",
                     /* La méthode utilisée pour transférer les données est GET */
                     type : 'GET',
                     /*Ici search value va prendre la chaine entrée par un utilisateur dans la zone de recherche et sera placée après l’url */
                     data: {
                         'search' : value
                     },
                     /*Cette fonction permet de vider le contenu du tableau pour recevoir le nouveau contenu*/
                     success : function(retour){
                         if(retour){
                             $('#t tbody#search').empty();
                             $.each(JSON.parse(retour), function(i, obj) {
                                 $('#t tbody#all').hide();

                                 $('#t tbody#search').append('<tr><td> '+obj.id+'  </td><td>    '+obj.titre+'  </td><td>'+obj.article_desc+' </td><td>'+obj.article_auth+' </td>'+obj.article_date+' </td><td><td><a href="/article/'+obj.id+'">Modifier</a></td></tr>');
                             });
                         }
                         else
                         {
                             $('#t tbody#all').show();
                             $('#t tbody#search').empty();
                             $('#t tbody#search').fadeIn('fast');
                         }
                     },
                 });
                 return false;
             });
         });
     </script>
     <div >

       {{ knp_pagination_render(articles) }}

     </div>
{% endblock %}
{% endblock %}